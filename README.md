Binary-image-de-noising
=======================

使用马尔科夫随机场对二值图进行降噪


开发平台
--------

Ubuntu Kylin 14.04


前期准备
--------

运行shell脚本安装必要工具，在终端输入以下命令

./install.sh


## 运行
在终端输入以下命令

ant


## 计算降噪率
必须在确保程序运行过一次在可以运行测试，在终端输入以下命令

ant test


## 程序打包
在终端下输入以下命令

ant jar


## 输入输出说明

输入输出均在pic目录下，其中：

输入test4.png为任意png格式彩图

test4_binary.png为输入图片的二值图

test4_noise.png为二值图加噪后的图片

test4_denoise.png为二值图降噪后的图


## 模型说明

  我们认为加噪后的每一点的像素yi =-1或+1（其中i为像素的下标，1=< i <= D）。假设原图（未经噪点污染的二值图）每一点的像素为xi=-1或者+1（其中i为像素下标，1=< i <= D）。我们使用随机噪点，在原图中随机抽出一定比例的点（此处我们抽取10%）进行像素反转得到噪点图。即存在10%的k属于[1，D]，使得yk = !xk。如下图：由于噪点占少数（本问题中只占10%），所以我们还认为降噪后的图中的像素应该降噪前的像素有很强的关联性即xi和yi关联很大。我还知道图片的像素有马尔可夫性，二值图中每个像素的的取值也可以近似的理解为只与其邻近的像素有关，而与其他地方的像素无关，即xi和其临近像素yi有很强关联性。

  ![Image text](https://github.com/JieweiWei/Binary-image-de-noising/blob/master/doc/Markv.png)
　

  对于上述两种相关对{xi，yi}和{xi，xj}我们分别使用一下能量函数进行描述：对于{xi，yi}关联函数，我们使用E1 = -nxiyi，其中n为正常数，如果xi，yi同号则E1 < 0，否则S1 > 0。我们期望即加噪后和降噪后的图片接近，即xi，yi同号，故E1越小效果越好。而对于{xi，xj}关联对，我们使用能量函数E2 = -bxixj，其中b为正常数，同样我们期望E2尽可能小。为了保证能量非负，我们选择添加了一个相关能量hxi，由于xi为原图每一点的像素，所以它对降噪后的图有着基础性的影响。综上所述，我们得出完整的能量函数：E(X, Y) = hΣxi - bΣxixj - nΣxiyi。我们根据能量函数定义联合分布p(x, y) = 1/z * exp(-E(X, Y))。由于y是已知的，为加噪后的图像。在该条件下，我们得到条件分布p(X | Y)。换而言之，我们需要找到一张图，其像素集为X，使得上述条件概率最大

  现在我们根据模型，使用简化的模型：梯度下降模型。首先，我们初始化所有xi = yi，即我们从噪点图出发，每次选出一个像素点xj，并计算xj = +1 和xj = -1而其他像素点不变时的总能量。比较两个结果能量，将xj像素设置成能量小的一方。每次迭代由于只有一个状态是改变的（+1 或 -1），所以两个状态的结果能量只能不变和上升或者不变和下降。我们选择能量下降的进行设置。


